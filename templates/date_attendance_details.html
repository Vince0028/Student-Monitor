{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>Attendance Details</h2>
            <p class="text-muted">
                {{ section_period.section.name }} - {{ section_period.period_name }} {{ section_period.school_year }}
                {% if section_period.section.strand %}
                    ({{ section_period.section.strand.name }})
                {% endif %}
                - {{ subject.subject_name }}
            </p>
            <p class="text-primary">
                <i class="fas fa-calendar"></i> {{ date.strftime('%B %d, %Y') }}
            </p>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="row mb-4">
        <div class="col">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-search"></i>
                </span>
                <input type="text" class="form-control" id="studentSearch" placeholder="Search student name...">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Student Attendance Status</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered mb-0">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            {% for student, attendance in attendance_records %}
                            <tr class="student-row">
                                <td class="student-name">{{ student.name }}</td>
                                <td class="text-center">
                                    {% if attendance %}
                                        <span class="badge rounded-pill 
                                            {% if attendance.status == 'present' %}bg-success
                                            {% elif attendance.status == 'absent' %}bg-danger
                                            {% elif attendance.status == 'late' %}bg-warning
                                            {% else %}bg-info{% endif %}">
                                            {{ attendance.status|title }}
                                        </span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-secondary">Not Recorded</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <a href="{{ url_for('teacher_section_attendance_history', section_period_id=section_period.id, subject_id=subject.id) }}" 
           class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to History
        </a>
    </div>
</div>

<style>
.input-group-text {
    background-color: #f8f9fa;
    border-right: none;
}

#studentSearch {
    border-left: none;
}

#studentSearch:focus {
    box-shadow: none;
    border-color: #ced4da;
}

.student-row.hidden {
    display: none;
}

.badge {
    font-size: 0.9em;
    padding: 8px 12px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('studentSearch');
    const studentRows = document.getElementsByClassName('student-row');

    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        Array.from(studentRows).forEach(row => {
            const studentName = row.querySelector('.student-name').textContent.toLowerCase();
            row.classList.toggle('hidden', !studentName.includes(searchTerm));
        });
    });
});
</script>
{% endblock %} 