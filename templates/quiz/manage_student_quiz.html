{% extends 'base.html' %}
{% block title %}Manage Student Quiz{% endblock %}
{% block content %}
<div class="container" style="max-width:900px; margin:2rem auto;">
    <h2>Manage Quiz for {{ student.name }}</h2>
    <hr>
    <h4>Quizzes & Attempts</h4>
    <table class="table table-bordered" style="width:100%;">
        <thead>
            <tr>
                <th>Quiz Title</th>
                <th>Score</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for row in quiz_rows %}
            <tr>
                <td>
                    {% if row.essay_questions and row.status == 'pending' %}
                        <a href="#essay-quiz-{{ row.quiz.id }}" class="btn btn-link" style="color:#2563eb; font-weight:600; text-decoration:underline;">{{ row.quiz.title }}</a>
                    {% else %}
                        {{ row.quiz.title }}
                    {% endif %}
                </td>
                <td>
                    {% if row.attempt %}
                        {{ row.attempt.score|int if row.attempt.score == row.attempt.score|int else row.attempt.score }} / {{ row.attempt.total_points|int if row.attempt.total_points == row.attempt.total_points|int else row.attempt.total_points }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>
                    {% if row.status == 'pending' %}
                        <span style="color:#2563eb;font-weight:600;">Pending (Manual Check Required)</span>
                    {% elif row.status == 'completed' %}
                        <span style="color:#43b581;font-weight:600;">Completed</span>
                    {% else %}
                        Not Attempted
                    {% endif %}
                </td>
                <td>
                    {% if row.essay_questions and row.attempt %}
                        <a href="{{ url_for('score_student_essay', section_period_id=section_period_id, subject_id=subject_id, student_id=student.id, quiz_id=row.quiz.id) }}" class="btn btn-primary btn-sm">
                            {% if row.status == 'pending' %}Check Essay{% else %}Edit Scores{% endif %}
                        </a>
                    {% else %}
                        —
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4">No quizzes found for this section/subject.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    {% for row in quiz_rows %}
        {% if row.essay_questions %}
        <!-- Removed inline essay scoring form. Now handled by dedicated page. -->
        {% endif %}
    {% endfor %}
    <div style="text-align: right; margin-top: 2rem;">
        <a href="{{ url_for('manage_quiz', section_period_id=section_period_id, subject_id=subject_id) }}" class="btn btn-secondary">
            &larr; Back to Quiz Manager
        </a>
    </div>
</div>
{% endblock %} 