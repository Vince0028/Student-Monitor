{% extends 'admin_base.html' %}
{% block nav %}
    <nav class="admin-nav-row" style="display: flex; align-items: center; gap: 0.5em;">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-primary"><i class="fas fa-home"></i> Dashboard</a>
        <a href="{{ url_for('manage_strands') }}" class="btn btn-primary"><i class="fas fa-layer-group"></i> Strands</a>
        <a href="{{ url_for('manage_users') }}" class="btn btn-primary"><i class="fas fa-user-cog"></i> Admin Users</a>
    </nav>
{% endblock %}
{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Manage Users</h2>
        <a href="{{ url_for('admin_logs') }}" class="btn btn-info btn-sm"><i class="fas fa-clipboard-list"></i> View Admin Logs</a>
    </div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5em; align-items: center; margin-bottom: 1.5em;">
        <form method="get" action="{{ url_for('manage_users') }}" style="display: flex; gap: 0.5em; align-items: center; flex-wrap: wrap;">
            <input type="hidden" name="user_type" value="{{ selected_user_type }}">
            {% if selected_user_type == 'student' %}
                <select name="grade_level" class="form-control" style="min-width: 120px;">
                    <option value="">All Grades</option>
                    {% for gl in grade_levels %}
                        <option value="{{ gl }}" {% if selected_grade_level == gl %}selected{% endif %}>{{ gl }}</option>
                    {% endfor %}
                </select>
                {% if normalized_grade_level == '11or12' %}
                    <select name="strand" class="form-control" style="min-width: 120px;">
                        <option value="">All Strands</option>
                        {% for s in strands %}
                            <option value="{{ s }}" {% if selected_strand == s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                {% endif %}
            {% endif %}
            <input type="text" name="search" value="{{ search }}" placeholder="Search username..." class="form-control" style="min-width: 180px;">
            <button type="submit" class="btn btn-outline btn-sm"><i class="fas fa-search"></i> Search</button>
        </form>
        <div style="margin-left: auto; display: flex; gap: 0.5em;">
            {% for type, label, icon in [
                ('admin', 'Admin', 'fa-user-shield'),
                ('teacher', 'Teacher', 'fa-chalkboard-teacher'),
                ('student', 'Student', 'fa-user-graduate'),
                ('parent', 'Parent', 'fa-user-friends')
            ] %}
                <a href="{{ url_for('manage_users', user_type=type) }}" class="btn btn-sm {% if selected_user_type == type %}btn-primary{% else %}btn-outline{% endif %}">
                    <i class="fas {{ icon }}"></i> {{ label }}
                </a>
            {% endfor %}
        </div>
    </div>
    <a href="{{ url_for('add_user_admin') }}?user_type={{ selected_user_type }}" class="btn btn-primary" style="margin-bottom: 1.5em;"><i class="fas fa-user-plus"></i> Add New {{ selected_user_type|capitalize }}</a>
    <div class="table-responsive">
        <table class="data-table" style="margin: 0 auto; min-width: 400px;">
            <thead>
                <tr>
                    <th style="text-align: left;">Username</th>
                    <th style="text-align: left;">User Type</th>
                    <th style="text-align: center;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td style="text-align: left;">{{ user.username }}</td>
                    <td style="text-align: left;">{{ user.user_type|capitalize }}</td>
                    <td style="text-align: center;">
                        {% if user.user_type == 'parent' %}
                        <a href="{{ url_for('edit_parent', parent_id=user.id) }}" class="btn btn-outline btn-sm" style="margin-right: 0.5em;"><i class="fas fa-edit"></i> Edit</a>
                        {% else %}
                        <a href="{{ url_for('edit_user', user_id=user.id) }}" class="btn btn-outline btn-sm" style="margin-right: 0.5em;"><i class="fas fa-edit"></i> Edit</a>
                        {% endif %}
                        <form action="{{ url_for('delete_user_admin', user_id=user.id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this user?');"><i class="fas fa-trash-alt"></i> Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %} 