{% extends 'student_base.html' %}

{% block title %}Take Quiz: {{ quiz.title }}{% endblock %}

{% block content %}
<style>
    body { background: #fff !important; }
    body.dark-mode .quiz-container {
        background: #23272f !important;
        color: #f3f4f6 !important;
    }
    body.dark-mode .question-card {
        background: #181a1b !important;
        color: #f3f4f6 !important;
        border-color: #334155 !important;
    }
    body.dark-mode .question-card * {
        color: #f3f4f6 !important;
    }
    body.dark-mode .form-check-label {
        color: #f3f4f6 !important;
    }
    body.dark-mode .question-input {
        color: #f3f4f6 !important;
    }
    body.dark-mode .question-header {
        color: #f3f4f6 !important;
    }
    .quiz-container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); overflow: hidden; }
    .quiz-header { background: #222; padding: 30px; color: #fff; text-align: center; border-radius: 20px 20px 0 0; }
    .quiz-title { font-size: 2.5rem; font-weight: 600; margin-bottom: 10px; color: #fff; }
    .quiz-subtitle { opacity: 0.9; font-size: 1.1rem; color: #f1f1f1; }
    .quiz-content { padding: 30px; }
    .question-card { background: #fff; border: 2px solid #e2e8f0; border-radius: 15px; padding: 25px; margin-bottom: 20px; position: relative; transition: all 0.3s ease; }
    .question-card:hover { border-color: #222; box-shadow: 0 10px 30px rgba(34,34,34,0.08); }
    .question-header { display: flex; align-items: center; margin-bottom: 20px; }
    .question-number { background: #222; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 15px; flex-shrink: 0; }
    .question-input { flex: 1; border: none; font-size: 1.2rem; padding: 10px 0; color: #222; background: transparent; }
    .question-input:focus { outline: none; border-bottom: 2px solid #222; }
    .form-check-input:checked { background-color: #222; border-color: #222; }
    .btn-primary { background: #222; color: #fff; border: none; padding: 12px 25px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(34,34,34,0.15); background: #111; }
    @media (max-width: 768px) { .quiz-container { margin: 10px; border-radius: 15px; } .quiz-content { padding: 20px; } .question-card { padding: 20px; } .quiz-title { font-size: 2rem; } }
    .timer-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f7fafc;
        border-bottom: 2px solid #2563eb;
        padding: 1.1rem 0 0.7rem 0;
        font-size: 1.25rem;
        font-weight: 600;
        color: #2563eb;
        letter-spacing: 1px;
        position: relative;
    }
    .timer-bar .timer-icon {
        font-size: 1.5rem;
        margin-right: 0.7rem;
        color: #2563eb;
    }
    .timer-bar .timer-warning {
        color: #e53e3e;
        font-weight: 600;
        margin-left: 1.2rem;
        font-size: 1.05rem;
    }
    /* Portal Blue Theme */
    .quiz-header {
        background: #2563eb !important;
        color: #fff !important;
    }
    .quiz-title {
        color: #fff !important;
    }
    .quiz-subtitle {
        color: #e3e6eb !important;
    }
    .question-number {
        background: #2563eb !important;
        color: #fff !important;
    }
    .btn-primary {
        background: #2563eb !important;
        color: #fff !important;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(37,99,235,0.10);
    }
    .btn-primary:hover, .btn-primary:focus {
        background: #174bbd !important;
        color: #fff !important;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37,99,235,0.15);
    }
</style>
<style>
body.dark-mode .question-card,
body.dark-mode .question-card *,
body.dark-mode .form-check-label,
body.dark-mode .question-input,
body.dark-mode .question-header {
    color: #f3f4f6 !important;
    }
</style>
<div class="quiz-container mt-4" style="margin-top: 20px;">
    <div class="quiz-header">
        <div class="quiz-title">{{ quiz.title }}</div>
        <div class="quiz-subtitle">Answer all questions below and submit when finished.</div>
    </div>
    <div class="quiz-content">
        {% if time_limit and time_left is not none %}
        <div class="timer-bar">
            <span class="timer-icon"><i class="fas fa-stopwatch"></i></span>
            Time Remaining: <span id="timerDisplay">--:--</span>
            <span class="timer-warning" id="timerWarning" style="display:none;">Time is up! Submitting...</span>
        </div>
        <script>
            let timeLeft = {{ time_left|int }};
            let timerDisplay = document.getElementById('timerDisplay');
            let timerWarning = document.getElementById('timerWarning');
            let quizForm = document.querySelector('.quiz-content form');
            function pad(n) { return n < 10 ? '0' + n : n; }
            function updateTimer() {
                if (timeLeft <= 0) {
                    timerDisplay.textContent = '00:00';
                    timerWarning.style.display = '';
                    // Disable all inputs
                    Array.from(quizForm.elements).forEach(e => e.disabled = true);
                    // Auto-submit with blank answers (grade 0)
                    setTimeout(function() {
                        quizForm.submit();
                    }, 1200);
                    return;
                }
                let min = Math.floor(timeLeft / 60);
                let sec = timeLeft % 60;
                timerDisplay.textContent = pad(min) + ':' + pad(sec);
                timeLeft--;
                setTimeout(updateTimer, 1000);
            }
            updateTimer();
        </script>
        {% endif %}
        <form method="POST">
            {% for question in questions %}
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">{{ loop.index }}</div>
                    <strong class="question-input">{{ question.text }}</strong>
                </div>
                <div>
                    <input type="hidden" name="question_id" value="{{ question.id }}">
                    {% if question.type == 'multiple_choice' %}
                        {% if question.allowMultiple %}
                            {% for option in question.options %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="answer-{{ question.id }}[]" id="option-{{ loop.index }}-{{ question.id }}" value="{{ loop.index0 }}">
                                    <label class="form-check-label" for="option-{{ loop.index }}-{{ question.id }}">
                                        {{ option.text }}
                                    </label>
                                </div>
                            {% endfor %}
                        {% else %}
                            {% for option in question.options %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="answer-{{ question.id }}" id="option-{{ loop.index }}-{{ question.id }}" value="{{ loop.index0 }}" required>
                                    <label class="form-check-label" for="option-{{ loop.index }}-{{ question.id }}">
                                        {{ option.text }}
                                    </label>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% elif question.type == 'essay_type' %}
                        <div class="mb-3">
                            <textarea class="form-control form-style-input" name="answer-{{ question.id }}" placeholder="Type your answer here" rows="8" required style="width:100%; min-height:180px; resize:vertical;"></textarea>
                        </div>
                    {% elif question.type == 'true_false' %}
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="answer-{{ question.id }}" id="true-{{ question.id }}" value="true" required>
                            <label class="form-check-label" for="true-{{ question.id }}">True</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="answer-{{ question.id }}" id="false-{{ question.id }}" value="false" required>
                            <label class="form-check-label" for="false-{{ question.id }}">False</label>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary btn-lg w-100">Submit Quiz</button>
        </form>
    </div>
</div>
{% endblock %} 