{% extends 'parent_base.html' %}

{% block title %}Grades - Parent Portal{% endblock %}

{% block content %}
<style>
    .grade-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(44, 62, 80, 0.07);
        margin-bottom: 2rem;
        padding: 1.5rem 2rem;
        transition: box-shadow 0.2s;
    }
    .grade-card:hover {
        box-shadow: 0 4px 24px rgba(44, 62, 80, 0.13);
    }
    .grade-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }
    .grade-card-header h4 {
        margin: 0;
        font-size: 1.3rem;
        color: #2563eb;
        display: flex;
        align-items: center;
        gap: 0.5em;
    }
    .grade-card-header .total-grade {
        font-size: 1.1rem;
        font-weight: 600;
        color: #357ab8;
        background: #e3f0ff;
        border-radius: 6px;
        padding: 0.3em 0.9em;
        display: flex;
        align-items: center;
        gap: 0.4em;
    }
    .component-row {
        background: #f1f5f9;
        color: #357ab8;
        font-weight: 600;
        font-size: 1.08em;
        border-top: 2px solid #e5e7eb;
    }
    .grade-table {
        width: 100%;
        border-collapse: collapse;
        background: #f8fafc;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 0.5em;
        min-width: 400px;
    }
    .grade-table th, .grade-table td {
        padding: 0.7em 1em;
        text-align: left;
    }
    .grade-table th {
        background: #f1f5f9;
        color: #2563eb;
        font-weight: 600;
        border-bottom: 2px solid #e5e7eb;
    }
    .grade-table tr:not(:last-child) td {
        border-bottom: 1px solid #e5e7eb;
    }
    .grade-table td {
        font-size: 1.05em;
    }
    .grade-item-icon {
        color: #357ab8;
        margin-right: 0.5em;
    }
</style>
<div class="parent-main-container">
    <div class="dashboard-header">
        <h2>Grades for {{ student.name }}</h2>
        <p>Below is a detailed breakdown of your child's grades for each subject and period.</p>
    </div>

    {% if periods %}
        {% for period, pdata in periods %}
        <div class="grade-card parent-card">
            <div class="grade-card-header" style="background: #f1f5f9; border-radius: 8px 8px 0 0;">
                <h4><i class="fas fa-calendar-alt grade-item-icon"></i> {{ period[0] }} {{ period[1] }}</h4>
            </div>
            {% for subject, data in pdata.subjects.items() %}
            <div class="grade-card parent-card" style="margin-top: 1.5em; margin-bottom: 1.5em;">
                <div class="grade-card-header">
                    <h4><i class="fas fa-book grade-item-icon"></i> {{ subject }}</h4>
                    <span class="total-grade"><i class="fas fa-star"></i> Total Grade: {{ '%.2f'|format(data.total_grade) if data.total_grade is not none else 'N/A' }}</span>
                </div>
                <div class="responsive-table-wrapper" style="max-height: 350px; overflow-y: auto; min-width: 400px;">
                    {% if data.details %}
                        {% set grouped = {} %}
                        {% for item in data.details %}
                            {% set _ = grouped.setdefault(item.component, []).append(item) %}
                        {% endfor %}
                        <table class="grade-table">
                            <thead>
                                <tr>
                                    <th style="width: 28%;">Component</th>
                                    <th>Item</th>
                                    <th>Score</th>
                                    <th>Max Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for component, items in grouped.items() %}
                                    <tr class="component-row">
                                        <td colspan="4"><i class="fas fa-layer-group"></i> {{ component }}</td>
                                    </tr>
                                    {% for item in items %}
                                    <tr>
                                        <td></td>
                                        <td><i class="fas fa-clipboard-list grade-item-icon"></i> {{ item.item_title }}</td>
                                        <td>{{ '%.2f'|format(item.score) }}</td>
                                        <td>{{ '%.2f'|format(item.max_score) }}</td>
                                    </tr>
                                    {% endfor %}
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                    <p style="color: #888;">No detailed grade items found for this subject.</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <h3>No Grades Found</h3>
            <p>This student does not have any grades recorded yet.</p>
        </div>
    {% endif %}
</div>
{% endblock %} 